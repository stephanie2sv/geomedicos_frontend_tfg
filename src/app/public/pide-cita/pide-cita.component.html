<div class="container mt-5">
  <h2 class="mb-4">Solicitar una nueva cita</h2>

  <form [formGroup]="citaForm" (ngSubmit)="onSubmit()">

    <div class="mb-3">
      <label for="especialidad" class="form-label">Especialidad</label>
      <select id="especialidad" formControlName="especialidad" class="form-select">
        <option value="" disabled>— Selecciona —</option>
        @for (esp of especialidades; track esp.idEspecialidad) {
          <option [value]="esp.idEspecialidad">{{ esp.nombre }}</option>
        }
      </select>
    </div>

    <div class="mb-3">
      <label for="fecha" class="form-label">Fecha deseada</label>
      <input type="date" id="fecha" formControlName="fecha" class="form-control" [min]="minFecha" (change)="buscarMedicosDisponibles()" />
    </div>

    @if(medicos){
      <div  class="mb-3">
        <h5>Seleccione un médico disponible:</h5>
        
        @for(medico of medicos; track medico.colegiado){
          @if(medico&& medico.nombre){
            <app-medico-card
              [medico]="medico"
              [control]="colegiadoControl"
              (select)="onTurnoSeleccionado($event)"> 
            </app-medico-card>
  }
        }
      </div>
    }@else if (citaForm.get('especialidad')?.value && citaForm.get('fecha')?.value) {
      <div class="alert alert-warning">No hay médicos disponibles para esa especialidad y fecha.</div>
    }

    @if(horariosDispobibles){
       <div class="mb-3">
        <label for="idHorario" class="form-label">Horario disponible</label>
        <select id="idHorario" formControlName="idHorario" class="form-select">
          <option value="" disabled selected>— Selecciona —</option>
          @for (horario of horariosDispobibles; track horario.idHorario) {
            <option [value]="horario.idHorario">
              {{ horario.fechaCita }} — {{ horario.horaInicio }}
            </option>
          }
        </select>
      </div>
    } @else if (citaForm.get('medico')?.value) {
      <div class="alert alert-warning">Este médico no tiene horarios disponibles para esa fecha.</div>
    }
    

    <button type="submit" class="btn btn-primary w-100 mt-3" [disabled]="citaForm.invalid">Solicitar cita</button>
   
  </form>

</div>
